<!doctype html>
<html>
<head>
    <meta charset="UTF-8" />
    <title> Mon super snake :) </title>
    <script src="//cdn.jsdelivr.net/phaser/2.5.0/phaser.min.js"></script>
</head>
<body>

    <script type="text/javascript">

        window.onload = function() {
        var snakeSize = 32;
        mapLength = 25;
        mapHeight = 19;
        var game = new Phaser.Game(snakeSize*mapLength, snakeSize*mapHeight, Phaser.CANVAS, 'phaser-example', { preload: preload, create: create, update: update,render : render });

        var c = 0;
        function preload() {

            game.load.image('square','square.png');
            game.load.image('food','food.png');

        }

        var snakeHead; 
        var snakeSection = new Array();
        var snakePath = new Array();
        var numSnakeSections = 3; 
        var move = null;
        var food = null;


        function create() {
            game.physics.startSystem(Phaser.Physics.ARCADE);
            game.world.setBounds(0, 0, snakeSize*mapLength, snakeSize*mapHeight);
            cursors = game.input.keyboard.createCursorKeys();          
          	initializeSnake();
          	registerInputHandlers();
          	move = moveRight;
            game.physics.enable(snakeSection[0], Phaser.Physics.ARCADE);

        }
        function moveLeft(sprite){
        	sprite.x -= 32 ;
        	sprite.x = (sprite.x + 32*mapLength) % (32*mapLength);
        }
        function moveRight(sprite){
        	sprite.x += 32 ;
        	sprite.x = sprite.x % (32*mapLength);
        }
        function moveUp(sprite){
        	sprite.y -= 32;
        	sprite.y = (sprite.y + 32*mapHeight) % (32*mapHeight);
        }
        function moveDown(sprite){
        	sprite.y += 32;
        	sprite.y = sprite.y % (32*mapHeight);
        }


        function registerInputHandlers(){

			key1 = game.input.keyboard.addKey(Phaser.Keyboard.UP);
    		key1.onDown.add(setMovementUp, this);
    		key1 = game.input.keyboard.addKey(Phaser.Keyboard.DOWN);
    		key1.onDown.add(setMovementDown, this);
    		key1 = game.input.keyboard.addKey(Phaser.Keyboard.LEFT);
    		key1.onDown.add(setMovementLeft, this);
    		key1 = game.input.keyboard.addKey(Phaser.Keyboard.RIGHT);
    		key1.onDown.add(setMovementRight, this);

        }
        function setMovementUp(){
        	if (move != moveDown && played) {
        		move = moveUp;
        		played = false;
        	}
        }
        function setMovementDown(){
        	if (move != moveUp&& played) {
        		move = moveDown;
        		played = false;
        	}
        }
        function setMovementLeft(){
        	if (move != moveRight&& played) {
        		move = moveLeft;
        		played = false;
        	}
        }
		function setMovementRight(){
			if (move != moveLeft&& played) {
				move = moveRight;
				played = false;
			}
        }

        function initializeSnake(){
        	for (var i = 0; i < 3; i++) {
	            snakeSection[i] = game.add.sprite(Math.floor(mapLength/2)*32-32*i, Math.floor(mapHeight/2)*32, 'square');
            	snakeSection[i].anchor.setTo(0, 0);
            }
            snakeHead = snakeSection[0];
        }

        function update() {
        	if (c % 100000 === 0) {
    			var coord = pickCoordinate();
        		food = game.add.sprite(coord.x, coord.y, 'food');
        		food.anchor.setTo(0,0);
        	}
            if (c % 10 == 0){
                for (var i = numSnakeSections - 1; i > 0 ; i--)
                {
                    snakeSection[i].x = snakeSection[i-1].x;
                    snakeSection[i].y = snakeSection[i-1].y;
                }
                move(snakeSection[0]);
                played = true;
            }
            c ++;
        }

        function render() {

            game.debug.spriteInfo(snakeHead, 32, 32);

        }

        function map2pix(px) {
        	return px*32;
        }

        function pickCoordinate() {
        	return {
        		x: map2pix(cocorico(0,mapLength)),
        		y: map2pix(cocorico(0, mapHeight))
        	};
        }
        function cocorico(min, max) { 
			return (Math.floor((max-min)*Math.random())+min); 
		}	

    };

</script>

</body>
</html>